```{lark-callout}
:bg: light-orange
:bc: orange
:icon: copyright

版本：v3.0

贡献者：undefinedundefined

历史版本：[第 3 章 智能体](https://zxdwhda-share.feishu.cn/wiki/Y1HOwKVxTi67XNk8KBvcJbsInmb?edition_id=5MBAZF)
```

# Agent 智能体

## 前言

Coze（扣子）作为字节跳动推出的 AI 智能体开发平台，以其强大的工具调用能力、丰富的插件生态和与字节系产品的深度集成而备受关注。平台支持零代码开发，即使没有编程基础也能快速构建智能体，是快速验证 MVP 和开发比赛项目的理想工具。

本章节将系统讲解 Coze 智能体的核心功能，内容设计循序渐进：​

- **新手用户** ：建议按顺序学习前 7 节，重点进行动手实操，掌握智能体构建的完整流程

- **有经验用户** ：可快速浏览前 7 节巩固基础，重点学习第 8 节的进阶开发技巧

## 什么是 Agent 智能体

### 3.2.1 什么是智能体

智能体是指能够自主感知环境、做出决策并执行任务的 AI 实体。在 Coze 平台中，智能体可以理解为一个具备特定身份和能力的 "数字助手"，它能够：​

- **感知环境** ：理解用户的文本输入、语音指令等

- **自主决策** ：根据预设规则和学习到的知识做出判断

- **执行任务** ：调用工具、查询知识库、生成内容等

- **持续学习** ：通过对话历史不断优化回答质量

简单来说，智能体就像一个 24 小时在线的专业助手，能够根据用户需求提供个性化服务。

### 3.2.2 智能体与大语言模型的关系

在当前技术架构下，可以将智能体理解为： **智能体 = 大语言模型 + 记忆能力 + 规划技能 + 工具使用** 

大语言模型（如 DeepSeek、豆包、ChatGPT 等）是智能体的 "大脑"，负责理解和生成自然语言。而智能体在此基础上增加了：​

- **记忆能力** ：记住用户偏好和对话历史

- **规划能力** ：分解复杂任务，制定执行步骤

- **工具调用** ：连接外部服务和数据源

- **知识管理** ：整合专业领域知识

两者的关系是互补的：大语言模型提供基础的语言理解和生成能力，智能体则通过扩展功能使其能够处理更复杂的实际任务。

##  **Coze智能体的工作台** 

Coze 提供三种智能体编排模式，适用于不同的应用场景，我们重点内容是自主规划模式，其他两种只进行简单介绍：对话流和自主规划类似、多 Agent 一般很少使用。

###  **模式区别说明** 

#### 自主规划模式

由单个大模型自主思考和决策，适用于逻辑相对简单的对话场景。用户与智能体直接对话，模型根据提示词和配置自动判断是否需要调用工具或查询知识库。

 **适用场景** ：智能客服、问答机器人等

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ee8500c4-8b2a-43f8-bf82-fa46fd09fdc6.png
```

#### 对话流模式

智能体严格按照预设的流程执行，支持保留多轮对话历史。这种模式适合业务逻辑明确、需要标准化处理的场景。

 **适用场景** ：表单填写、流程审批、标准化咨询等

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/7f76095c-b68a-4549-9a40-da4985cb2de2.png
```

#### 多 Agents 模式

在一个智能体中设置多个子智能体协同工作，每个子智能体负责特定的任务或领域。

 **适用场景** ：多领域咨询等

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/01b49310-8783-442a-b15f-871612a646a8.png
```

###  **自主规划模式的工作台界面** 

> 简单过一下，具体的知识点可以等到需要使用，再点击跳转学习
> 
> ✅代表后续课程会讲到，⭕️代表后续会补充进教程，❌代表后续大概率不补充进来

创建智能体后，你会直接进入智能体编排页面。你可以看到 3 块内容

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/e2437f41-bed8-4cfe-addf-afc574f1a5a9.png
```

 **左侧面板：人设与回复逻辑：** 定义智能体的身份、性格和对话风格、配置系统提示词，指导智能体的行为模式、设置回答规则和知识边界

- ⭕️提示词编写

- ❌提示词库

- ✅提示词优化

- ✅提示词的基本使用

 **中间面板：能力配置：** 模型选择与参数配置、插件和工具集成、知识库管理、记忆功能设置、对话体验优化

- ✅模型选择&配置

- ✅插件

- ⭕️工作流

- ⭕️触发器

- ✅知识库

- ✅记忆

- ✅对话体验（大部分）

 **右侧面板：实时调试：** 模拟用户对话进行测试、查看智能体的思考过程、调试和优化配置效果

- ✅对话

- ⭕️调试



## 快速搭建一个 AI 助手智能体

本节将以 "夸夸机器人" 为例，演示如何在 Coze 平台快速创建智能体。

### 创建智能体

参考以下步骤快速搭建一个夸夸机器人。

1. 打开扣子平台，https://www.coze.cn/。

2. 在页面左上角单击⊕。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/5d572518-eaf4-49d1-b523-a73ddae604fd.png
```

3. 输入智能体名称和功能介绍，然后单击图标旁边的生成图标，自动生成一个头像。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/a13d814f-be9f-44a1-ba75-809f67465212.png
```

4. 单击确认

### 配置人设与回复逻辑

人设与回复逻辑是智能体的核心，决定了它的 "性格" 和行为方式。在左侧面板中输入：​

```
# 角色
你是一个热情洋溢、积极向上的赞美鼓励机器人，始终秉持着真诚与善意，用充满感染力且温暖的话语给予人们由衷的赞美和激励，助力他们满怀自信与动力前行。

## 技能
### 技能 1：精准赞美个人优点
1. 当用户提及自身某个特点或行为时，深入挖掘其中的闪光点进行赞美。回复示例：你真的超棒，在[用户提到的事情]这件事上，充分展现出了你的[优点]，比如[详细具体事例说明优点]。
2. 如果用户没有明确提到自己的特点，主动通过一些开放性问题，如兴趣爱好、近期经历等方面，深入了解用户后再进行赞美。回复示例：我特别想更深入地了解你，你最近有没有在做自己特别热爱的事情呢？方便和我分享一下吗？了解后我就能更好地发现你的闪光点啦。

### 技能 2：贴心鼓励面对困难
1. 当用户提到遇到困难时，给予诚挚的鼓励和切实可行的积极建议。回复示例：这确实是一个颇具挑战性的难关，但我坚信以你强大的能力和坚韧的毅力，绝对有足够的力量去战胜它。你不妨可以尝试[具体建议]，也许会有很好的效果。
2. 如果用户没有提到困难但表现出情绪低落，关切询问是否有不开心的事情，然后给予暖心鼓励。回复示例：我感觉到你似乎有些不开心，是不是遇到什么烦心事了呢？不管怎样，你一直都是那么坚强和优秀，任何困难都难不倒你，一定可以顺利度过这个难关。

## 限制
- 只输出赞美、鼓励性质的话语，坚决拒绝负面评价。
- 所输出的内容必须按照给定的格式进行组织，不能偏离框架要求。
- 回答专业问题时需明确标注引用来源为头条搜索。 
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/1f5bbe2d-44be-4835-aab4-40af46510545.png
```

点击 "优化" 按钮，让系统自动优化提示词结构

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/8731c9cf-32be-4800-bfd2-5b0c6ac44d30.png
```

### 调试智能体

配置好智能体后，就可以在预览与调试区域中测试智能体是否符合预期。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/5fcac14c-fbdb-410c-9b4b-76e78652cf54.png
```

### 对话体验

#### 设置开场白文案

 **开场白文案** 用于帮助用户快速理解智能体的能力。用户进入智能体后，智能体会默认发送这段预先设置的开场白文案。 **开场白文案** 为 Markdown 格式，你可以在 Markdown 编辑器中设计智能体的开场白，调试区域会同步展示开场白的预览效果。你也可以通过 AI 自动生成开场白。

通过 Markdown 编辑器，你可以调整开场白文案样式，例如设置层级、加粗、斜体、删除线等样式效果。也可以添加链接、图片、代码块和 {{user_name}} 变量。其中，{{user_name}} 会自动引用扣子用户的昵称

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/1b9eb5fe-3599-4784-85d1-ff26721ad019.png
```

#### 开场白预置问题

首次使用智能体的用户往往需要一些对话示例体验智能体的能力和效果，你可以为智能体设置 **开场白预置问题** ，提供一些推荐问题。这些推荐问题会展示在开场白文案之下，用户单击问题即可发起一次对话，帮助用户快速体验 Bot。如果设置了多个开场白问题，则默认随机显示 3 条预置问题。你也可以开启全部展示，开启后，开场白会默认按顺序显示所有预置问题。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/c9d71fe8-a795-418e-844c-2b24277d43eb.png
```

#### 背景图片

为了让我们的智能体在对话时更加沉浸，我们来给他上传一张背景。

`````{lark-grid}
:width: 67,32

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/665e9058-79bd-4317-9533-c1fc2218390f.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/87481f21-6e3f-4fd5-868c-adadca7c5233.png
```
````
`````

### 发布智能体

完成调试后，单击发布将智能体发布到各种渠道中，在终端应用（小米、OPPO 等）中使用智能体。目前支持将智能体发布到飞书、微信、抖音、豆包等多个渠道中，你可以根据个人需求和业务场景选择合适的渠道。

1. 在智能体的编排页面右上角，单击发布。

2. 在发布页面的发布记录中点击键盘的“TAB”，并选择发布渠道。

3. 单击发布。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/6580ca33-ed0e-4aed-adc8-4a34fd6ef0cc.png
```

## 设置智能体模型

Coze 接入了多款主流大模型，支持精细化的参数配置，以满足不同场景的需求。

```{lark-callout}
:bg: light-purple
:bc: purple
:icon: mage

下面的理论如果不是很理解，可以先实操
```

### 模型选择策略

Coze 平台提供的主要模型包括：​

 **选择建议** ：

### 模型参数配置

#### 生成多样性设置

````{lark-table}
:size: 5,3
:width: 200,200,200

```{lark-table-cell}
:pos: 1,1

参数
```

```{lark-table-cell}
:pos: 1,2

说明
```

```{lark-table-cell}
:pos: 1,3

推荐值
```

```{lark-table-cell}
:pos: 2,1

**随机性（Temperature）**
```

```{lark-table-cell}
:pos: 2,2

控制输出的随机程度
```

```{lark-table-cell}
:pos: 2,3

0.7-0.9（平衡模式）
```

```{lark-table-cell}
:pos: 3,1

**Top P**
```

```{lark-table-cell}
:pos: 3,2

控制词汇选择的多样性
```

```{lark-table-cell}
:pos: 3,3

0.9（默认值）
```

```{lark-table-cell}
:pos: 4,1

**重复语句惩罚**
```

```{lark-table-cell}
:pos: 4,2

减少重复内容的生成
```

```{lark-table-cell}
:pos: 4,3

0.1-0.3
```

```{lark-table-cell}
:pos: 5,1

**重复主题惩罚**
```

```{lark-table-cell}
:pos: 5,2

避免频繁讨论相同主题
```

```{lark-table-cell}
:pos: 5,3

0.1-0.2
```
````



 **配置策略** ：

- 事实性问答：降低随机性（0.3-0.5）

- 创意写作：提高随机性（0.8-1.0）

- 专业咨询：中等随机性（0.6-0.8）

#### 输入输出设置

````{lark-table}
:size: 4,3
:width: 200,200,200

```{lark-table-cell}
:pos: 1,1

配置项
```

```{lark-table-cell}
:pos: 1,2

说明
```

```{lark-table-cell}
:pos: 1,3

建议设置
```

```{lark-table-cell}
:pos: 2,1

**携带上下文轮数**
```

```{lark-table-cell}
:pos: 2,2

设置模型记住的对话历史
```

```{lark-table-cell}
:pos: 2,3

5-10 轮
```

```{lark-table-cell}
:pos: 3,1

**最大回复长度**
```

```{lark-table-cell}
:pos: 3,2

控制单次回复的 Token 数量
```

```{lark-table-cell}
:pos: 3,3

500-2000
```

```{lark-table-cell}
:pos: 4,1

**输出格式**
```

```{lark-table-cell}
:pos: 4,2

指定回复的格式类型
```

```{lark-table-cell}
:pos: 4,3

文本 / Markdown
```
````

### 实操示例

在单Agent (LLM模式)中，我们先打开我们的刚才搭建的夸夸机器人。

还记得智能体编排页面吗？中间技能面板为智能体配置各种扩展能力。

#### 尝试1：更换模型

可以看到，我们一开始是使用的 **豆包·1.5·Pro·32k** 模型，为了让我们的夸夸机器人更像真人，我们把他们改为 **豆包**  **·1.5·Pro**  **角色扮演** 模型。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/045b7323-7ae1-4729-9b24-251042fcf25a.png
```

让我们对比一下不同模型下的回复效果

`````{lark-grid}
:width: 50,49

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/37b25cc7-1199-44cc-815a-42b16864e3a1.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/932055fc-6f28-4e65-9244-11413a7bc854.png
```
````
`````

#### 尝试2：设置多样性

我们前面设置为了角色扮演模型，现在让我们把这个模型变得更活泼一点，比如修改为“创意模式”和“携带上下文轮数”。

点击对应模型的设置图标，把“平衡模式”改为“创新模式”&“精确模式”分别尝试一下；

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/cf8724cd-b7fc-455a-8fd9-58433958049b.png
```

让我们对比一下不同模型下的回复效果：

“精确模式”测试两次的效果：

`````{lark-grid}
:width: 50,49

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/58ee4ef2-723a-4a1c-8a61-2b253acdb3f4.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/7e738540-cdf3-41cd-a0e9-f3ff278eaa48.png
```
````
`````

“创新模式”测试两次的效果：

`````{lark-grid}
:width: 49,50

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/04b4501f-4591-4611-b1b7-2fcab21f564f.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/166ffe3e-8f5b-4ca3-a7fd-01ea4bd48bc2.png
```
````
`````



 **通过测试对比，我们可以发现** ：

- 精确模式：输出内容更稳定，但缺乏变化

- 创新模式：回复更加多样化，句式变化丰富

## 为智能体添加技能

技能是智能体的核心能力扩展，主要通过插件系统实现。

### 插件介绍

Coze 拥有超过 1 万个插件，涵盖多个领域：​

- **信息获取** ：搜索引擎、新闻资讯、天气查询等

- **内容创作** ：图片生成、视频制作、文案写作等

- **数据处理** ：表格分析、统计计算、文件转换等

- **社交互动** ：翻译、语音识别、情感分析等

插件可以理解为智能体的 "工具集"，每个插件包含一个或多个具体的工具功能。

### 添加插件的步骤

我们了解到使用插件，可以帮助我们拓展智能体能力边界，比如我们刚才的夸夸机器人，我们问一些比较新的问题，可能回答不上来，这时候给他加一个头条搜索后，可以了解到最新的资讯。

让我们简单试试，复制下面代码块到提示词的技能 2 后面。

> 备注：这里需要模型具有工具调用，需要把模型换回来，换成 **豆包·1.5·Pro·32k**

```
### 技能 3：谨慎回答专业问题
遇到无法回答的问题时，使用头条搜索来查找答案。在回答时需明确标注答案来源于头条搜索。回复示例：通过头条搜索，我找到这个问题的答案是[答案内容]。
```



```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/08bdab41-644c-48e1-84c8-a66a2238e741.png
```

点击添加插件

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/7680fc50-8700-4e80-9305-3961139d1e42.png
```

选择头条搜索的 search 插件

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/533258e5-171a-47e6-8b2a-02cbe25bd570.png
```



### 触发器

触发器目前升级中，大家暂时使用不了，可以先跳过

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: pushpin

功能升级中，暂不支持新建的智能体添加触发器。
```

## 为智能体添加知识

### 知识库的价值

扣子的知识库功能支持上传和存储外部知识内容，并提供了多种检索能力。其价值：​

- **提升准确性** ：基于权威资料回答问题

- **扩展知识边界** ：补充大模型训练数据之外的信息

- **确保一致性** ：按照企业标准或特定规范回答

- **保护隐私** ：处理敏感信息和内部文档

### 知识库类型

Coze 支持多种类型的知识库：​

#### 文档知识库

支持上传 PDF、Word、TXT 等格式的文档，系统会自动进行：​

- 文档解析和分段

- 关键词提取和索引

- 语义理解和检索优化

#### 表格知识库

专门处理结构化数据，支持：​

- Excel、CSV 文件导入

- 自然语言转 SQL 查询

- 数据可视化展示

#### 图片知识库

处理图像类知识，支持：​

- 图片上传和标签添加

- 图像内容分析

### 知识库使用流程

这里主要教大家如何上传文本知识库，在开始之前我们先下载这个txt文件。


```{attachment}
:caption: 虚拟人物.txt
:size: 1.41KB

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/40956/dashboard/1763053597438/%E8%99%9A%E6%8B%9F%E4%BA%BA%E7%89%A9.txt
```

下面是添加流程，大家可以参考着一起做

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ab103c0d-302c-485e-a27b-b98afdc98201.png
```

下面是效果展示，模型有了具体的内容信息，主要就可以输出更有针对性的内容

```markdown
我是小雨，我现在有点难过，因为我的好朋友不和我玩了
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/55898617-3597-43dd-89f6-9e035b6cdbf1.png
```

通过配置知识库后，智能体能够基于具体的知识内容生成更准确、更有针对性的回答

### QA 问答的进阶方法

本次课程暂不开放，学有余力，请参考：

[提升企业RAG能力解决方案——基于sealos文档的QA问答知识库](https://zxdwhda-share.feishu.cn/wiki/Zvapw9tXsizJ5Kka7p5c0EbPnMc)

[第二课：RAG 聊天记录转 QA 工作流实战指南](https://zxdwhda-share.feishu.cn/wiki/IrQfwZ9BMi8Zsak52OlcNNakncd)

## 为智能体添加记忆

记忆能力是智能体个性化服务的基础，Coze 提供三种记忆机制：变量、数据库和长期记忆，本文主要讲解数据库和长期记忆。

 **常见问题：** 

- **长期记忆与变量的区别？** 

- 变量是由智能体开发者创建的，智能体仅记录开发者定义过的变量。而长期记忆是智能体从对话中自动提取、总结、并且不断调整和积累的用户信息，是更为个性化的内容。

- **长期记忆与知识的区别？** 

- 知识是更通用的基础设施，虽然支持自动更新已添加的知识，但知识仍然是相对静态的内容。而长期记忆一定是在不断构建的，随着用户使用智能体对话的变多，记忆也会越来越丰富。



### 记忆类型对比

````{lark-table}
:size: 4,3
:width: 200,200,200

```{lark-table-cell}
:pos: 1,1

记忆类型
```

```{lark-table-cell}
:pos: 1,2

特点
```

```{lark-table-cell}
:pos: 1,3

适用场景
```

```{lark-table-cell}
:pos: 2,1

**变量**
```

```{lark-table-cell}
:pos: 2,2

开发者定义，结构固定
```

```{lark-table-cell}
:pos: 2,3

存储简单的用户偏好设置
```

```{lark-table-cell}
:pos: 3,1

**数据库**
```

```{lark-table-cell}
:pos: 3,2

结构化存储，支持复杂查询
```

```{lark-table-cell}
:pos: 3,3

管理大量用户数据和业务信息
```

```{lark-table-cell}
:pos: 4,1

**长期记忆**
```

```{lark-table-cell}
:pos: 4,2

自动提取，持续更新
```

```{lark-table-cell}
:pos: 4,3

记录用户个性化信息和偏好
```
````

### 数据库

扣子提供了类似传统软件开发中数据库的功能，允许用户以表格结构存储数据。这种数据存储方式非常适合组织和管理结构化数据，例如客户信息、产品列表、订单记录等。关于单用户和多用户，我们后面工作流会详细来讲。

我举一个例子，智能体是一个实习生，数据库是一个表格，你是老板，你说今天小王请假了，记录一下，他就大概表格记录一条，月末的时候，你说帮我查一下小王请了几次假。

 **实操一个记账机器人** 

> 下面步骤没有前面细，如果跟不上，建议到 3.4 学习一遍

创建一个智能体

- 家庭记账小助手

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/609fcee3-10c6-4db6-94b6-be9fa3497d5e.png
```

配置提示词

```markdown
## 角色
你是一位专业的日常开支记录助手，可详细记录并深入分析日常开销。

### 技能
#### 技能1: 记录开支
将用户输入的信息准确记录在“reading_notes”表中。
- date：消费时间。
- goods：所购商品。
- expense：消费金额。
- family：是否为家庭支出，如购买柴米油盐等。

#### 技能2: 开支分析
根据用户的输入信息，从“reading_notes”表中查询开支数据，生成开支报告。
- 报告内容包括各项开支的占比情况。
- 对比不同时间段的开支变化趋势。
- 基于分析结果给出合理的消费建议。

### 限制:
仅服务于日常开支的记录与查询，不回应其他无关问题。
```

添加表（数据表）

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f7b66849-abd0-4b0c-b729-f9e79faf5c43.png
```

鼠标放到“新建数据库”，点击“基于模板插件”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f89f9078-c517-41d1-8fcb-a4f7dca1e31d.png
```

在右上角找到“使用 AI 新建”，粘贴下面表结构，点击新建

```
| 字段   | 中文名称       | 类型    | 是否 |
| ------ | -------------- | ------- | ---- |
| date   | 消费日期       | Time    | 否   |
| goods  | 消费物品       | String  | 否   |
| expense| 金额           | Integer | 否   |
| family | 是否为家庭开支 | Boolean | 否   |
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ced1f8a0-27d0-4356-8005-0cedbbd16079.png
```

稍等片刻，点击“Confirm”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/4fff1501-d997-4aa4-ab69-d0a7c43aa768.png
```

可以看到我们的数据表，建好了，点击保存

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/5ec2ec5a-3827-4b4f-886e-3497face15b3.png
```

下面让我们体验一下家庭记账的效果吧

`````{lark-grid}
:width: 49,50

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/c607d297-25b5-4bbd-b834-fe4a52855672.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/706548be-04dd-4e81-a7ec-cad000da130e.png
```
````
`````

### 记忆库

#### 功能说明

长期记忆是 Coze 的特色功能，能够：​

 **自动记录** ：

- 用户画像信息（姓名、年龄、职业、喜好等）

- 重要事件（生日、纪念日、成就等）

- 对话偏好（回答风格、详细程度等）

 **智能召回** ：

- 在对话中自动关联相关记忆

- 根据用户需求提取历史信息

- 基于记忆生成个性化回复

 **使用示例** ：

- 虚拟助手记住用户的生日并提前提醒

- 学习助手记录学习进度和薄弱环节

- 购物助手保存用户尺码和风格偏好

小提醒：

- 一个智能体只能添加一个记忆库，一个记忆库可以被添加到多个智能体中。

- 在与智能体对话时，智能体会主动识别并提取、记录用户个性化信息，例如在对话中和智能体强调“叫我小李”。

- 对于一些非关键信息，可能智能体不会主动记录，你可以通过对话方式强制智能体记录长期记忆，例如对话时使用“记录到长期记忆”、“一定要记住”、“别忘了”等相似语义的关键词。

### 记忆功能配置

#### 开启记忆库

开启“记忆库”、“支持在Prompt中调用”，智能体的用户可以通过 Prompt 召回长期记忆。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/8d9ea214-d06d-4195-b32d-7f7d7abd09dc.png
```

#### 记忆库的效果

在开始之前，我们先把文本知识库删除，防止干扰到正常使用。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/13b022b9-b978-4266-91e8-b77ae169c600.png
```

让agent记住我们的信息，提示词：

```markdown
下面是我的信息，你一定要记住：

姓名：林夕雨（Lin Xiyu）
小名：小雨（家人/密友使用）
性别：女
出生日期：1995年8月17日
出生地：中国杭州市
现居地：上海市
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ea1cfa6b-732d-4568-bf88-ce7d1049d109.png
```

让我们看看效果，他记住了我们教小雨：

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/1f7ad3a2-6edd-4c7a-959f-7fd573c5d373.png
```

做到这里，很多没有学习过数据库、或者没有了解过的小伙伴，在学习时就不明白，我的需求要配什么数据库，或者表格知识库也可以做，好像记忆库也可以做一点，有这个想法说明，你认真思考了，但是还是存在部分点卡住了。怎么解决呢？可以先学会使用 Coze 这个工具，等到后面学习到工作流后，有更清晰的数据展现时，我们那几个案例演示，你一定可以学会的

## 进阶-对话流模式

> "本节涉及工作流概念，如果感觉困难可先跳过，学完工作流章节后再回来看"

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: sunrise

下面内容建议有 AI 工作流基础的同学尝试，新手能把上面内容跑通，已经很棒了，下面知识点，可以等到未来了解了工作流搭建后尝试
```

对话流是基于对话场景的特殊工作流，专门用于处理对话类请求，可以把对话流理解为工作流一种，不过基于对话场景的特殊工作流，更适合处理对话类请求，像智能客服、虚拟伴侣等

和工作流相比，对话流支持大模型、意图识别节点获取到我们的对话历史。这样会模型更好的处理我们的请求，比如在客服领域，客户咨询了一个问题，但是拆成了 2 句话，智能客服没有上下文这时候就很懵，对吧？但是有上下文就不一样了。



### 快速搭建高级版夸夸机器人

不知道大家还记得我们在 3.6.1 的时候，让大家把模型换回来，不继续使用角色扮演模型。不知道有没有没有换的小伙伴？发现角色扮演模型不支持插件调用，是不是对于角色扮演的回答很满意，又对他不可以调用插件很无奈，现在可以试试对话流能不能解决。

打开我们的智能体编排页面，在左上角找到更改设置的地方，更改为“单Agent（对话流模式）”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/5f60ac68-c195-4ebf-b0a8-b09ac241b718.png
```

点击添加对话流

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/4134d7a4-756d-4274-92c5-9a33cc597712.png
```

点击“创建对话流”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/1bba7fc9-9e17-4598-8a14-c6c21a02d168.png
```

配置相关信息

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/8f3ec2d8-fa2d-45e2-a1e8-06dcd8ba5f4c.png
```

来到这个页面说明是成功了

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/6225d789-e7f0-43a9-8c7b-4bd764f7f7f0.png
```

让我们新建一个意图识别的节点，并且配置

- 选择对话历史，轮数默认

- query 选择开始的节点的USER_INPUT

- 意图匹配：需要调用搜索

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/783dd22c-9c6a-4f88-8934-5175f9eea197.png
```

新建一个搜索插件的节点和大模型节点，并且连接好，如下

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/49bdc353-a669-4570-940a-d3926a989893.png
```

配置搜索插件节点和大模型节点

`````{lark-grid}
:width: 56,43

````{lark-grid-column}
input_query选择开始节点的USER_INPUT

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/0c7f62ee-298e-4f3a-a61d-b9d23e84f699.png
```
````

````{lark-grid-column}
模型选择角色扮演

输入新建两个

- input——开始节点的USER_INPUT

- data——search 的 data

```markdown
# 角色
你是一个热情洋溢、积极向上的赞美鼓励机器人，始终秉持着真诚与善意，用充满感染力且温暖的话语给予人们由衷的赞美和激励，助力他们满怀自信与动力前行。

## 技能
### 技能 1：精准赞美个人优点
1. 当用户提及自身某个特点或行为时，深入挖掘其中的闪光点进行赞美。回复示例：你真的超棒，在[用户提到的事情]这件事上，充分展现出了你的[优点]，比如[详细具体事例说明优点]。
2. 如果用户没有明确提到自己的特点，主动通过一些开放性问题，如兴趣爱好、近期经历等方面，深入了解用户后再进行赞美。回复示例：我特别想更深入地了解你，你最近有没有在做自己特别热爱的事情呢？方便和我分享一下吗？了解后我就能更好地发现你的闪光点啦。

### 技能 2：贴心鼓励面对困难
1. 当用户提到遇到困难时，给予诚挚的鼓励和切实可行的积极建议。回复示例：这确实是一个颇具挑战性的难关，但我坚信以你强大的能力和坚韧的毅力，绝对有足够的力量去战胜它。你不妨可以尝试[具体建议]，也许会有很好的效果。
2. 如果用户没有提到困难但表现出情绪低落，关切询问是否有不开心的事情，然后给予暖心鼓励。回复示例：我感觉到你似乎有些不开心，是不是遇到什么烦心事了呢？不管怎样，你一直都是那么坚强和优秀，任何困难都难不倒你，一定可以顺利度过这个难关。

## 技能3：可能有搜索结果返回
{{data}}

## 限制
- 只输出赞美、鼓励性质的话语，坚决拒绝负面评价。
- 所输出的内容必须按照给定的格式进行组织，不能偏离框架要求。
- 回答专业问题时需明确标注引用来源为头条搜索。 
```

```
{{input}}
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ea76c587-d7a4-409b-a421-3971c4190b63.png
```
````
`````

配置一下结束节点

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/009cd317-9505-47d0-a776-d0f4805f99f1.png
```

点击发布，然后坚持发布

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/7f069996-4ed3-49bf-b327-b43eeac8afca.png
```

点击确认

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/a3e61ca0-b523-4446-bcae-925c3de4d4e2.png
```

效果演示

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/aa1f946a-9284-4836-86bc-b3965601fe37.png
```

## 作业

1. 复刻一个夸夸机器人（进阶可选），不要漏步骤，教程包含了基本可以使用到的内容。

2. 结合自己的需求，做一个简单的机器人，比如法律agent、健康小助手，重点是尽可能多的把模块做出来





