# 深度搜索
本文参考coze官方模板编写，点击下面链接可以直接跳转复制
https://www.coze.cn/template/workflow/7421484735613911051

## 模板介绍
通用搜索模板，支持输入命题，从互联网上检索信息，判断用户的命题是否正确。

## 实现流程

可以把这个工作流拆解为四个部分：输入处理、搜索材料、生成初步总结、判断是否证明

![[attachment/Pasted image 20250204140452.png]]

| 功能     | 说明                                                          |
| ------ | ----------------------------------------------------------- |
| 输入处理   | LLM根据用户的输入生成几条有针对性的搜索query<br>然后输出                          |
| 搜索材料   | 根据上一节点的**搜索query**，使用搜索插件搜索<br>使用代码节点处理搜索节点<br>把处理好的内容展现给用户 |
| 生成初步总结 | LLM根据用户的输入和搜索内容进行总结<br>然后展示给用户                              |
| 判断是否证明 | 判断是否可以证明（回答）用户的问题<br>输出展示结果                                 |
## 使用官方模板复制

### 步骤一：复制模板
1. 登录扣子专业版账号，并访问[**深度搜索**](https://www.coze.cn/template/workflow/7421484735613911051)[模板页面](https://www.coze.cn/template/workflow/7421484735613911051)。
2. 选择工作流所属空间，然后单击**复制并继续编辑**。
![[attachment/Pasted image 20250204140724.png]]

### 步骤二：测试并发布
测试工作流效果并发布。

1. 在工作流编排页面右上角单击**试运行**。
2. 右侧调试区域，输入问题进行测试。你也可以单击创建测试集，方便测试调优效果。
3. 完成测试后可单击**发布**，并将工作流绑定到智能体中使用。


## 动手搭建

下面我们将从下面三个步骤来讲解

### 步骤一：创建工作流

在个人空间插件一个工作流

| 工作流名称 | CrossCheck                      |
| ----- | ------------------------------- |
| 工作流描述 | 用户输入一个命题，从互联网上检索信息，判断用户的命题是否正确。 |


### 步骤二：设计实现方案

| 功能     | 说明                                                          |
| ------ | ----------------------------------------------------------- |
| 输入处理   | LLM根据用户的输入生成几条有针对性的搜索query<br>然后输出                          |
| 搜索材料   | 根据上一节点的**搜索query**，使用搜索插件搜索<br>使用代码节点处理搜索节点<br>把处理好的内容展现给用户 |
| 生成初步总结 | LLM根据用户的输入和搜索内容进行总结<br>然后展示给用户                              |
| 判断是否证明 | 判断是否可以证明（回答）用户的问题<br>输出展示结果                                 |

#### 输入处理
需要新建两个节点：大模型节点和输出节点

- **大模型节点配置**

节点名称与类型：`生成搜索query`——单次

| 配置项   | 值                                                                                                     | 其他             |
| ----- | ----------------------------------------------------------------------------------------------------- | -------------- |
| 模型    | 无要求                                                                                                   |                |
| 技能    | 无                                                                                                     |                |
| 输入    | input                                                                                                 | 开始-Question    |
| 系统提示词 | 命题：{{input}}<br>请根据上面的命题，生成几条有针对性的搜索query，帮助用户进一步了解或验证命题的真实性。确保这些query能够涵盖相关的基本背景信息、事实依据或其他影响判断的关键信息。 |                |
| 输出    | 输出格式JSON                                                                                              |                |
| 输出-1  | search_query                                                                                          | Array< String> |
- **输出节点配置**

节点名称与类型：`1_分解声明`


| 配置项    | 值                                                   | 其他                      |
| ------ | --------------------------------------------------- | ----------------------- |
| 输出变量-1 | search_query                                        | 生成搜索query——search_query |
| 输出内容   | #### 一、分解声明<br><br>{{search_query}}<br><br><br><br> |                         |
|        |                                                     |                         |

连接节点
![[attachment/Pasted image 20250204163049.png]]

#### 搜索材料
需要新建三个节点：插件节点、代码节点和输出节点

- **插件节点配置**

在官方插件中查找，选择头条搜索插件的工具`search`

节点名称与类型：`搜索材料`——批处理

| 配置项            | 值     | 其他                     |
| -------------- | ----- | ---------------------- |
| 批处理-1          | item1 | 生成搜索query-search_query |
| 输入-input_query | item1 | 搜索材料-item1             |

![[attachment/Pasted image 20250204151806.png]]


- **代码节点配置**

节点名称与类型：`处理输出结果`——批处理

| 配置项  | 值                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 其他               |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------- |
| 输入-1 | outputList                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 搜索材料——outputList |
| 代码   | async def main(args: Args) -> Output:<br><br>    params = args.params<br><br>    outputList = params['outputList']<br><br>    markdown_str = ""<br><br>    message_count = 0<br><br>    for item in outputList:<br><br>        data = item.get('data', {})<br><br>        doc_results = data.get('doc_results', [])<br><br>        for doc in doc_results:<br><br>            sitename = doc.get('sitename', '')<br><br>            summary = doc.get('summary', '')<br><br>            title = doc.get('title', '')<br><br>            url = doc.get('url', '')<br><br>            # 拼接 markdown 格式<br><br>            markdown_str += f"##### {title}\n\n"<br><br>            markdown_str += f"**网站**: {sitename}\n\n"<br><br>            markdown_str += f"**摘要**: {summary}\n\n"<br><br>            markdown_str += f"[点击这里查看详情]({url})\n\n\n"<br><br>            message_count = message_count + 1<br><br>    ret: Output = {<br><br>        "markdown_str": markdown_str,<br><br>        "message_count": message_count,<br><br>    }<br><br>    return ret | IDE语言——Python    |
| 输出-1 | markdown_str                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | String           |
| 输出-2 | message_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Integer          |
- **输出节点配置**

节点名称与类型：`2_展示搜索过程`


| 配置项    | 值                                                                         | 其他                   |
| ------ | ------------------------------------------------------------------------- | -------------------- |
| 输出变量-1 | output                                                                    | 处理输出结果-message_count |
| 输出变量-2 | info                                                                      | 处理输出结果-markdown_str  |
| 输出内容   | #### 二、交叉核对信息<br><br>检索到了**{{output}}**个来源...<br><br>{{info}}<br><br><br> |                      |
![[attachment/Pasted image 20250204163113.png]]

#### 生成初步总结

需要新建两个节点：大模型节点和输出节点

- **大模型节点配置**

节点名称与类型：`生成初步总结`——单次

| 配置项   | 值                                                                                                      | 其他                  |
| ----- | ------------------------------------------------------------------------------------------------------ | ------------------- |
| 输入-1  | search_result                                                                                          | 处理输出结果-markdown_str |
| 输入-2  | user_input                                                                                             | 开始-Question         |
| 系统提示词 | 用户命题：<br>{{user_input}}<br>根据用户命题搜索到的信息：<br>{{search_result}}<br>请根据上述信息，针对用户命题的内容，总结搜索到的信息，并输出总结后的信息。 |                     |
| 输出    | 输出格式JSON                                                                                               |                     |
| 输出-1  | search_query                                                                                           | String              |
- **输出节点配置**

节点名称与类型：`3_初步搜索结论`


| 配置项    | 值                                                                     | 其他                   |
| ------ | --------------------------------------------------------------------- | -------------------- |
| 输出变量-1 | output                                                                | 生成初步总结-summary       |
| 输出变量-2 | count                                                                 | 处理输出结果-message_count |
| 输出内容   | #### 三、初步总结<br><br>我在分析了**{{count}}**个来源后，得到以下初步结论：<br>{{output}}<br> |                      |
|        |                                                                       |                      |

![[attachment/Pasted image 20250204170628.png]]
#### 判断是否证明
需要新建四个节点：一个大模型节点和两个输出节点

- **大模型节点配置**

节点名称与类型：`生成初步总结`——单次

| 配置项   | 值                                                                                                      | 其他                  |
| ----- | ------------------------------------------------------------------------------------------------------ | ------------------- |
| 输入-1  | search_result                                                                                          | 处理输出结果-markdown_str |
| 输入-2  | user_input                                                                                             | 开始-Question         |
| 系统提示词 | 用户命题：<br>{{user_input}}<br>根据用户命题搜索到的信息：<br>{{search_result}}<br>请根据上述信息，针对用户命题的内容，总结搜索到的信息，并输出总结后的信息。 |                     |
| 输出    | 输出格式JSON                                                                                               |                     |
| 输出-1  | search_query                                                                                           | String              |

- **选择器节点配置**

节点名称与类型：`选择器`

| 配置项 | 值   | 其他                 |
| --- | --- | ------------------ |
| 如果  | =   | 判断是否已被证明-is_proved |
| 否则  | \   | \                  |




- **输出节点配置**

节点名称与类型：`4_结论1`


| 配置项    | 值                                               | 其他                  |
| ------ | ----------------------------------------------- | ------------------- |
| 输出变量-1 | output                                          | 判断是否已被证明-conclusion |
| 输出内容   | #### 四、反思<br>{{output}}<br>#### 当前命题已验证完成，流程结束！ |                     |

节点名称与类型：`5_结论2`

| 配置项    | 值                                                                             | 其他                  |
| ------ | ----------------------------------------------------------------------------- | ------------------- |
| 输出变量-1 | output                                                                        | 判断是否已被证明-conclusion |
| 输出内容   | #### 四、反思<br>{{output}}<br>#### 很遗憾，经过深度探索，仍然无法帮您验证命题，可能您的命题答案并不广泛存在于互联网的知识中。 |                     |

![[attachment/Pasted image 20250204170649.png]]


### 步骤三：测试并发布工作流

完成工作流修改后，你就可以测试工作流效果并发布。

1. 在工作流编排页面右上角单击**试运行**。
2. 右侧调试区域，输入问题进行测试。你也可以单击创建测试集，方便测试调优效果。
3. 完成测试后可单击**发布**，并将工作流绑定到智能体中使用。
