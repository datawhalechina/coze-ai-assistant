```{lark-callout}
:bg: light-orange
:bc: orange
:icon: copyright

版本：v3.0

贡献者：undefined

历史版本：[第 4 章 资源的玩法](https://zxdwhda-share.feishu.cn/wiki/M7towKWKhiLMxWkTCincqhDAnjc?edition_id=C7FUB2)
```

内容更新中~

# 资源的玩法

## 资源的定义

插件、知识库、数据库、提示词库、音色等在 Coze 中都是属于资源的一种

### 本章节的意义在哪



### 本章怎么学习

对于非技术背景，本章具有一定的上手难度，建议理论学习，等到第 5 章学习完后，回来实操



## 插件

### 什么是插件？

> 参考：https://www.coze.cn/open/docs/guides/plugin

插件是一个工具集，一个插件内可以包含一个或多个工具（API）。

目前，Coze集成了类型丰富的插件，包括资讯阅读、旅游出行、效率办公、图片理解等 API 及多模态模型。使用这些插件，可以帮助我们拓展智能体能力边界。例如，我们第三章的夸夸智能体内添加搜索插件，我们的智能体将拥有搜索新闻资讯的能力。

当Coze集成的插件不满足我们的使用需求，我们还可以创建自定义插件来集成需要使用的 API，后面我会从IDE 创建插件、通过 JSON 或 YAML 文件导入插件，教大家如何扩展我们的使用边界。

（API的方式放在第6章）

### 使用 IDE 创建插件

> 制作谷歌搜索插件为例
> 
> 参考：https://www.coze.cn/open/docs/guides/ide

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: grinning

如果想学习零代码从0到1插件谷歌插件，跳转：[【Coze插件】零代码创建谷歌插件](https://zxdwhda-share.feishu.cn/wiki/Z4YGw0fSSinTn6kX6jlcP6uunje?fromScene=spaceOverview)
```

#### 前期准备

> 参考：https://zhuanlan.zhihu.com/p/174666017

官方需要非大陆链接，而且需要外币卡，所以我们使用这里使用 `serper` ：https://serper.dev/

- 有免费的额度，可以调用2500次

- 国内直连

这里不多演示注册，复制key，后面需要

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/a9c3ec9d-be52-47cb-9f14-d727e425a000.png
```

#### 新建插件资源与工具

先让我们创建一个插件

- **插件名称** ： `谷歌搜索` 

- **插件描述** ： `搜索网页` 

- **插件工具创建方式** ： `云侧插件 - 在 Coze IDE 中创建` 

- **IDE 运行时** ： `Node.js` 

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/5adace35-1278-4c25-81fa-e6d9c0a824a4.png
```

让我们创建一个工具，点击“在IDE中创建工具”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/997779a4-69bd-4d46-8b20-7a0f4debec16.png
```

点击左上角的“创建工具”

- 名称：Google_Search_Express

- 描述：谷歌搜索快速版

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/999cd40b-6cbd-4c12-bd04-fc04b72e514e.png
```

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: grinning

## 好的，老规矩，先看布局（其实是知识点讲解，跳过可点击：[第 4 章 资源的玩法](https://zxdwhda-share.feishu.cn/wiki/M7towKWKhiLMxWkTCincqhDAnjc?fromScene=spaceOverview#OnOhdBNb7oFtQVxlhFucTheGno5)）
```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/d1c26ee0-2cc1-4ad0-bd9e-bea877f8028d.png
```

让我们逐条分析



1. 这里是工具列表，我们刚才新建了一个 `Google_Search_Express` ，所以不是空置，有同学要问了，这里对应商店的是哪里，让我们以 `飞书云文档` 为例

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/b28aa40a-cff1-4a95-8e65-2d1f933ffcc9.png
```

大家可以发现，插件是有好几个工具的，还记得前面说的“插件是一个工具集，一个插件内可以包含一个或多个工具（API）。”，我们刚才创建的插件是有一个工具（当然也可以有多个），而 `飞书云文档` 有多个。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/56a332e0-816c-4bbc-8360-66487202a31f.png
```

2. 依赖包

> **依赖包** 区域，管理依赖包，所有工具共用该依赖列表。
> 
> 单击 **+** 或者单击 **添加依赖** 按钮，输入依赖包名称并选择版本（可通过依赖名@版本号的格式进行搜索），然后安装依赖包。

在编程中，依赖包（也称为库、模块或包）是预先编写好的代码集合，用于解决特定的问题或提供特定的功能。是可复用的代码集合，提供特定功能（如数据处理、网络请求、UI组件等）。开发者通过导入这些包来避免重复造轮子，提升开发效率。

3. 代码

> 不同 IDE 运行时的代码模板不同，这里是Node.js的代码模板。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/91090acd-abd7-4808-90b0-d28f06355117.png
```

这里是你写或者让AI编写代码的地方。

4. 元数据

元数据的作用是让大语言模型理解每个工具输入或输出参数有哪些、各个参数有何含义。因此，在工具的元数据内提供详细的参数说明，可以让大语言模型更准确的使用工具。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/c72b01dd-0317-4444-8fac-cb8a9b33c508.png
```

当用户在使用该工具的智能体时，模型会根据工具的元数据信息，从用户问答中解析、提取出对应的输入参数，并选择调用该工具，流程图如下所示。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/bd37a400-8957-4c0c-9cd9-befa5009a23a.png
```

元数据配置说明：

````{lark-table}
:size: 6,2
:width: 100,804

```{lark-table-cell}
:pos: 1,1

配置项
```

```{lark-table-cell}
:pos: 1,2

描述
```

```{lark-table-cell}
:pos: 2,1

名称
```

```{lark-table-cell}
:pos: 2,2

工具名称。建议输入清晰易理解的名称，便于后续大语言模型搜索与使用工具。
```

```{lark-table-cell}
:pos: 3,1

描述
```

```{lark-table-cell}
:pos: 3,2

工具的描述信息，一般用于记录当前工具的用途。
```

```{lark-table-cell}
:pos: 4,1

启用
```

```{lark-table-cell}
:pos: 4,2

是否启用当前工具。使用说明：
- 如果工具未开发测试完成，建议先禁用该工具，只启用并发布已通过测试的工具。
- 如果需要下线某一工具，可将该工具设置为禁用，并再次发布插件。- 如果插件中只有一个工具，则不支持禁用该工具。如需下线该工具，您可以选择直接删除该插件，或者创建另一个工具并完成开发测试后，再禁用该工具，最后发布插件。
```

```{lark-table-cell}
:pos: 5,1

输入参数
```

```{lark-table-cell}
:pos: 5,2

当前工具对应接口的输入参数信息。准确、清晰易理解的参数名称、描述等信息，可以让大语言模型更准确的使用工具。
```

```{lark-table-cell}
:pos: 6,1

输出参数
```

```{lark-table-cell}
:pos: 6,2

当前工具对应接口的输出参数信息。准确、清晰易理解的参数名称、描述等信息，可以让大语言模型更准确的使用工具。
```
````



5. 测试相关

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/aff1d82b-7dcf-4f2b-a992-17691220d7ee.png
```

让我们先看测试代码，分别有输入、输出；一般我们做测试的时候只需要写输入就可以使用了，输出后面可以让Coze一键生成。而控制台是我们查看运行日志。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/b0651870-2854-4324-ba53-0e2d9fea5726.png
```

这是日志，日志一般只保留7天

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: +1

## 好了！通过刚才的学习，相信你一定对插件与工具之间的作用有了一定的了解，下面让我们开始实操。
```

#### 完善工具

> 想学习怎么写代码的可以看这个[【Coze插件】零代码创建谷歌插件](https://zxdwhda-share.feishu.cn/wiki/Z4YGw0fSSinTn6kX6jlcP6uunje?fromScene=spaceOverview)

安装依赖包，搜索“ `axios` ”

`````{lark-grid}
:width: 70,29

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/844a7154-a51a-44a4-94f0-5e09fe43aafc.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/093579c7-3aea-4a17-a3cd-d6d1f1445f3d.png
```
````
`````

复制代码粘贴

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f9f4c541-db7e-4e82-9b74-fd2dae2adf71.png
```

```typescript
import { Args } from '@/runtime';
import axios from 'axios';

interface Input {
  q: string;     // 必填：搜索关键词
  key: string;   // 必填：API密钥
}

interface SearchResult {
  title: string;
  link: string;
  snippet: string;
}

interface Output {
  success: boolean;
  error?: string;
  results: SearchResult[];
  related?: string[];
}

export async function handler({ input, logger }: Args<Input>): Promise<Output> {
  // 基本参数验证
  if (!input.q || !input.key) {
    const errorMsg = 'Missing required parameters: both "q" and "key" are required';
    logger.error(errorMsg);
    return {
      success: false,
      error: errorMsg,
      results: []
    };
  }

  try {
    const { data } = await axios({
      method: 'post',
      url: 'https://google.serper.dev/search',
      headers: { 
        'X-API-KEY': input.key, // 使用动态API密钥
        'Content-Type': 'application/json'
      },
      data: JSON.stringify({
        q: input.q,
        gl: 'us',       // 默认国家：美国
        hl: 'en',       // 默认语言：英语
        num: 10,        // 默认结果数：10
        page: 1,        // 默认页码：1
        location: '',   // 默认地点：空
        tbs: ''         // 默认日期范围：空
      }),
      timeout: 10000
    });

    logger.info(`Successfully fetched ${data.organic?.length || 0} results for "${input.q}"`);
    
    // 结果格式化
    const results: SearchResult[] = data.organic?.map((item: any) => ({
      title: item.title,
      link: item.link,
      snippet: item.snippet
    })) || [];

    return { 
      success: true,
      results,
      related: data.related?.map((r: any) => r.query) || []
    };

  } catch (error: any) {
    // 精简错误信息提取
    const errorMsg = error.response?.data?.message || error.message || 'Unknown search error';
    logger.error(`Search failed for "${input.q}": ${errorMsg}`);
    
    return {
      success: false,
      error: errorMsg,
      results: []
    };
  }
};
```

编辑输入参数

- 名称 `q` 
  
  - *搜索关键词*
  
- 描述 `Key` 
  
  - *API密钥*
  
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/3cf1fa38-6719-4171-82b0-2a80c6477ef1.png
```

实操不好的小伙伴，看视频：

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/9757c856-9ce5-486a-b01b-8cb541060e58.png
```

#### 测试

点击右上角“自动生成”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f020e159-a2ce-4a02-9974-46e260ba2d55.png
```

修改默认的内容，点击运行

`````{lark-grid}
:width: 48,51

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/e68af3a9-f7b2-45f5-bc50-b89d32d19559.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/07d5365a-c0bf-4f6a-8359-1cd0559a581c.png
```
````
`````

可以看到运行结果

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/17d0475c-8d69-480f-b6a4-836cba486773.png
```

点击“更新输出参数”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/1ab7cbae-b921-45c0-a36c-51ff8f9227cb.png
```

出现这个说明正常，有的时候会卡

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/830aea64-a14a-4416-b2fc-5165c46294b6.png
```

我们可以看到输出参数给我们写好了

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f544a850-b150-4fc9-980c-701eae75ce28.png
```

#### 发布

点击发布，稍等

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/31953f7e-74d4-4a19-9027-97dd7e9c3da0.png
```

返回到智能体就可以看到了~

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/a98fdcf8-f1f1-49e8-bf72-3a4f879f07f1.png
```

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: +1

好了，我把最难的放在了前面，后面的就简单了很多，加油！
```

### 通过 JSON 或 YAML 文件导入插件

> 制作gpt-4o插件为例
> 
> 参考：https://help.302.ai/docs/ji-cheng-dao-Coze-guo-nei-ban?search=1

这个工具使用较少，建议跳过

#### 前期准备

这里使用的302.AI，使用原因：是题目的文档中的 YAML 文件使用比较详细，而且新人有免费额度，不做其他推荐使用，请自行寻找中转接口。

让我们注册：https://302.ai/

打开后台，添加API，复制，后面有用

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/96bab0ba-eac0-42be-b269-fc82a00921ff.png
```

#### 新建插件资源与工具

先让我们创建一个插件，点击导入

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f9fcf7c0-11df-408c-95c4-22c4ac110b6c.png
```

点击“URL和原始数据”，复制粘贴下面内容

```yaml
info:
    description: 302_AI
    title: 302_AI
    version: v1
openapi: 3.0.1
paths:
    /v1/chat/completions:
        post:
            operationId: Chat
            parameters:
                - description: 302.AI管理后台-API超市-API管理，复制生成的API Key
                  in: header
                  name: Authorization
                  required: true
                  schema:
                    default: sk-xxx
                    type: string
            requestBody:
                content:
                    application/json:
                        schema:
                            properties:
                                message:
                                    default: Hello
                                    description: 发给LLM的消息
                                    type: string
                                model:
                                    default: gpt-4o
                                    description: LLM的模型名
                                    type: string
                            required:
                                - message
                                - model
                            type: object
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                properties:
                                    output:
                                        description: LLM的输出
                                        type: string
                                type: object
                    description: new desc
                default:
                    description: ""
            summary: |-
                和各个llm进行单轮对话。模型列表请查看302.AI官网API文档，国内国外开源模型全部支持。
                仅需要输入model和message，即可获得output，是最简单的调用各种大模型的插件。
                非常适合用在各种对文本能力要求高的工作流中，当作单纯的输入和输出流程使用。
servers:
    - url: https://api.302.ai/v1/chat/completions

```

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/9e1ea2d8-fa41-4d8e-831c-cab0e70a8208.png
```

导入插件——下一步——确认

`````{lark-grid}
:width: 48,51

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ac41223b-6b19-4df4-a4d1-00af9a3f7e33.png
```
````

````{lark-grid-column}
```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/dc22b7f1-c6dc-449d-83f3-7f13fd4a1ffb.png
```
````
`````

开启“启用”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/0979b945-2d1b-402e-9aa0-7d572e31e8c3.png
```

点击调试

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/60c57eb4-3d45-41ea-a53a-c40b9b61f9aa.png
```

点击“试运行”

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/ae52470e-9c9c-47d0-8106-e2e711311178.png
```

点击运行（{bg:#f76964}`注意填写密钥`）

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/d0b584db-d7e4-4aa8-86e5-ef12612618e5.png
```

运行成功

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/08cef916-c979-4f17-87eb-e0124b8cf01e.png
```

#### 发布

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/f1103a58-b052-41d2-87c8-92905b92364e.png
```



## 知识库

> 本小节基于扣子知识库，不含“火山知识库”相关知识

大模型由于其工作原理，虽然可以回答通用的问题，但在专业技术的垂直领域中，模型知识的技术深度、更新及时性和准确性非常有限。如果对于模型生成的文本准确性的要求较高，例如企业智能客服、高精尖科学技术服务等应用场景中，往往需要通过知识库集成私有的知识数据，丰富 AI 应用的知识范围、提高模型回复的可靠性。

### 知识库概述

Coze的知识能力可以解决大模型幻觉、专业领域知识不足的问题，提升大模型回复的准确率。

> 参考：https://www.coze.cn/open/docs/guides/knowledge

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/50a75272-aa6c-488d-8daa-56562b08d391.png
```

#### 功能概述

知识库功能包含两个能力，一是存储和管理外部数据的能力，二是增强检索的能力。

- 数据管理与存储

扣子支持从多种数据源例如本地文档、在线数据、Notion、飞书文档等渠道上传文本和表格数据。上传后，扣子可将知识内容自动切分为一个个内容片段进行存储，同时支持用户自定义内容分片规则，例如通过分段标识符、字符长度等方式进行内容分割。

- 增强检索

扣子的知识功能还提供了多种检索方式来对存储的内容片段进行检索，例如使用全文检索通过关键词进行内容片段检索和召回。

大模型会根据召回的内容片段生成最终的回复内容。

#### 知识与记忆对比

扣子的知识和记忆能力都可以用来存储数据。在使用时可以从最终的使用者和存储的数据内容上进行区分。

- 知识：知识是供智能体或工作流调用的静态数据，可在空间内共享。由开发者创建和维护，智能体的终端用户无法对知识内容进行修改。

- 记忆：扣子提供了数据库、变量、长期记忆等记忆功能。通常这些数据是智能体的终端用户在使用智能体时产生的动态数据，不支持跨智能体使用。

以一个租房平台的智能体为例，下表展示了哪些数据是需要通过知识功能来维护的，哪些数据是通过记忆功能来维护的。

```{img}
:caption: 
:frac: 100%

https://datawhale-business.oss-cn-hangzhou.aliyuncs.com/image/3d3b2b0d-9296-4d3d-83fb-d736cfc9071c.png
```

### 知识库类型

> 参考：https://www.coze.cn/open/docs/guides/d03ccwxl

使用知识库功能的第一步就是上传知识内容。上传知识内容又分为两步，首先选择要上传的知识类型和上传方式，然后对上传的内容进行切分。合理的内容分片可以提升召回内容的相关性，从而提升大模型回复问题的准确性。

```{lark-callout}
:bg: light-orange
:bc: orange
:icon: +1

## 我们这里上传两组知识库，给大家看看他们的区别

1. **文本+表格** 

2. **照片**
```

- **文本类型** 
  
  - 文本知识库支持基于内容片段进行检索和召回，大模型结合召回的内容生成最终内容回复，适用于知识问答等场景。
  
- **表格类型** 
  
  - 表格知识库支持基于索引列的匹配（表格按行进行划分），同时也支持基于 NL2SQL 的查询和计算。
  
- **照片知识库** 
  
  - 照片知识库支持基于标注信息的匹配，适用于图像生成场景。
  
直播内容：数据还没有去密~

1. **文本+表格** 

https://github.com/datawhalechina/happy-llm



2. **照片** 


### 教大家使用QA问答

直播内容

[提升企业RAG能力解决方案——基于sealos文档的QA问答知识库](https://zxdwhda-share.feishu.cn/wiki/Zvapw9tXsizJ5Kka7p5c0EbPnMc?from=from_copylink)

## 模型的选择

直播内容



## 提示词





## 卡片

直播内容



